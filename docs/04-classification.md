# ü§ñ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è - ML –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –¥–≤—É–º—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏: **TF-IDF + Logistic Regression** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ **XLM-RoBERTa Large** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç **85%**, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∑—ã–≤–æ–≤.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
```mermaid
graph TD
    A[–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞] --> B[–†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –∫–ª–∞—É–∑—ã]
    B --> C[TF-IDF –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä]
    B --> D[XLM-RoBERTa –º–æ–¥–µ–ª—å]
    C --> E[–ü—Ä–æ–¥—É–∫—Ç—ã/—É—Å–ª—É–≥–∏]
    D --> F[–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º]
    E --> G[–ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    F --> G
    G --> H[–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
1. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Å–≤–æ–µ–π –∑–∞–¥–∞—á–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: TF-IDF –±—ã—Å—Ç—Ä –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
3. **–ö–∞—á–µ—Å—Ç–≤–æ**: XLM-RoBERTa –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## üìä –ú–æ–¥–µ–ª—å 1: TF-IDF + Logistic Regression

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–ª–∞—É–∑ –ø–æ **13 –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –ø—Ä–æ–¥—É–∫—Ç–∞–º/—É—Å–ª—É–≥–∞–º**

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```python
# –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
TfidfVectorizer(
    max_features=10000,
    ngram_range=(1, 3),
    min_df=2,
    max_df=0.95,
    stop_words=russian_stopwords
)

# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
OneVsRestClassifier(
    LogisticRegression(
        C=1.0,
        max_iter=1000,
        class_weight='balanced'
    )
)

# –ú—É–ª—å—Ç–∏–ª–µ–π–±–ª –±–∏–Ω–∞—Ä–∏–∑–∞—Ç–æ—Ä
MultiLabelBinarizer()
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **–†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è**: 10,000 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **N-–≥—Ä–∞–º–º—ã**: 1-3 (—É–Ω–∏–≥—Ä–∞–º–º—ã, –±–∏–≥—Ä–∞–º–º—ã, —Ç—Ä–∏–≥—Ä–∞–º–º—ã)
- **–û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞**: 46,312 —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –∫–ª–∞—É–∑
- **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è**: ~15 –º–∏–Ω—É—Ç
- **–í—Ä–µ–º—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞**: <1 –º—Å –Ω–∞ –∫–ª–∞—É–∑—É

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ TF-IDF –º–æ–¥–µ–ª–∏

| –ü—Ä–æ–¥—É–∫—Ç | Precision | Recall | F1-Score | Support |
|---------|-----------|--------|----------|---------|
| **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** | 0.89 | 0.92 | 0.90 | 5,812 |
| **–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞** | 0.87 | 0.85 | 0.86 | 3,888 |
| **–î–µ–Ω–µ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã** | 0.84 | 0.88 | 0.86 | 2,556 |
| **–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞** | 0.82 | 0.84 | 0.83 | 2,380 |
| **–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç** | 0.81 | 0.83 | 0.82 | 2,372 |
| **–í–∫–ª–∞–¥—ã** | 0.88 | 0.86 | 0.87 | 2,048 |
| **–ò–ø–æ—Ç–µ–∫–∞** | 0.90 | 0.89 | 0.89 | 2,020 |
| **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** | 0.85 | 0.87 | 0.86 | 1,804 |
| **–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** | 0.83 | 0.81 | 0.82 | 1,692 |
| **–†–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤** | 0.86 | 0.84 | 0.85 | 1,252 |
| **–î—Ä—É–≥–æ–µ** | 0.75 | 0.78 | 0.76 | 1,216 |
| **–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç** | 0.91 | 0.88 | 0.89 | 848 |
| **–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ** | 0.87 | 0.85 | 0.86 | 400 |
| **–û–±–º–µ–Ω –≤–∞–ª—é—Ç** | 0.93 | 0.89 | 0.91 | 172 |

**–û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏**:
- **Macro F1-Score**: 0.85
- **Micro F1-Score**: 0.86
- **Weighted F1-Score**: 0.85
- **–¢–æ—á–Ω–æ—Å—Ç—å (Accuracy)**: 0.84

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤
```python
# –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
thresholds = {
    "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ": 0.35,
    "–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞": 0.40,
    "–î–µ–Ω–µ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã": 0.45,
    "–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞": 0.42,
    "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç": 0.38,
    "–í–∫–ª–∞–¥—ã": 0.41,
    "–ò–ø–æ—Ç–µ–∫–∞": 0.36,
    "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ": 0.43,
    "–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ": 0.44,
    "–†–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤": 0.39,
    "–î—Ä—É–≥–æ–µ": 0.50,
    "–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç": 0.33,
    "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ": 0.37,
    "–û–±–º–µ–Ω –≤–∞–ª—é—Ç": 0.30
}
```

## üß† –ú–æ–¥–µ–ª—å 2: XLM-RoBERTa Large

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –±–∞–Ω–∫–æ–≤—Å–∫–æ–º—É –ø—Ä–æ–¥—É–∫—Ç—É —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```python
class XLMRTopicsSent(torch.nn.Module):
    def __init__(self, base_model_name="FacebookAI/xlm-roberta-large", 
                 num_topics=13, num_states=4, dropout=0.1):
        super().__init__()
        self.encoder = AutoModel.from_pretrained(base_model_name)
        hidden = self.encoder.config.hidden_size  # 1024
        self.dropout = torch.nn.Dropout(dropout)
        self.classifier = torch.nn.Linear(hidden, num_topics * num_states)
        
    def forward(self, input_ids, attention_mask):
        enc_out = self.encoder(input_ids, attention_mask)
        cls = enc_out.last_hidden_state[:, 0]  # [CLS] —Ç–æ–∫–µ–Ω
        logits = self.classifier(self.dropout(cls))
        logits = logits.view(-1, 13, 4)  # [batch, topics, states]
        return logits
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å**: FacebookAI/xlm-roberta-large
- **–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏**: ~2.2 GB
- **–°–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π**: 1024 –∏–∑–º–µ—Ä–µ–Ω–∏–π
- **–í—ã—Ö–æ–¥–Ω–æ–π —Å–ª–æ–π**: 13 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ √ó 4 —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–µ—Ç/–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞**: 128 —Ç–æ–∫–µ–Ω–æ–≤
- **Batch size**: 32

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è
```python
training_args = {
    "learning_rate": 2e-5,
    "batch_size": 32,
    "epochs": 4,
    "warmup_steps": 500,
    "weight_decay": 0.01,
    "optimizer": "AdamW",
    "scheduler": "linear_with_warmup",
    "dropout": 0.1,
    "max_grad_norm": 1.0
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ XLM-RoBERTa –º–æ–¥–µ–ª–∏

#### –ü–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (–æ–±—â–∞—è)
| –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å | Precision | Recall | F1-Score | Support |
|-------------|-----------|--------|----------|---------|
| **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ** | 0.83 | 0.81 | 0.82 | 3,840 |
| **–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ** | 0.86 | 0.88 | 0.87 | 8,144 |
| **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ** | 0.87 | 0.89 | 0.88 | 16,076 |

**–û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**:
- **Macro F1-Score**: 0.86
- **Weighted F1-Score**: 0.87
- **Accuracy**: 0.86

#### –ü–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º —Å —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
| –ü—Ä–æ–¥—É–∫—Ç | –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ F1 | –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ F1 | –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ F1 | –û–±—â–∏–π F1 |
|---------|----------------|---------------|----------------|----------|
| **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** | 0.79 | 0.85 | 0.91 | 0.85 |
| **–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞** | 0.84 | 0.87 | 0.86 | 0.86 |
| **–î–µ–Ω–µ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã** | 0.81 | 0.89 | 0.88 | 0.86 |
| **–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞** | 0.80 | 0.84 | 0.87 | 0.84 |
| **–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫—Ä–µ–¥–∏—Ç** | 0.78 | 0.83 | 0.89 | 0.83 |
| **–í–∫–ª–∞–¥—ã** | 0.87 | 0.88 | 0.84 | 0.86 |
| **–ò–ø–æ—Ç–µ–∫–∞** | 0.89 | 0.86 | 0.82 | 0.86 |
| **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** | 0.76 | 0.84 | 0.92 | 0.84 |
| **–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ** | 0.74 | 0.82 | 0.90 | 0.82 |
| **–†–µ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤** | 0.82 | 0.85 | 0.86 | 0.84 |
| **–î—Ä—É–≥–æ–µ** | 0.72 | 0.79 | 0.81 | 0.77 |
| **–ê–≤—Ç–æ–∫—Ä–µ–¥–∏—Ç** | 0.88 | 0.87 | 0.85 | 0.87 |
| **–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ** | 0.85 | 0.84 | 0.83 | 0.84 |
| **–û–±–º–µ–Ω –≤–∞–ª—é—Ç** | 0.90 | 0.89 | 0.88 | 0.89 |

## üîÑ Inference Pipeline

### –ö–ª–∞—Å—Å InferencePipeline
```python
class InferencePipeline:
    def __init__(self, tfidf_path: str, xlmr_path: str):
        self.tfidf_model = TfidfClassifier(tfidf_path)
        self.xlmr_tokenizer, self.xlmr_model, self.xlmr_config = load_pretrained(xlmr_path)
        
    def run_from_json(self, json_data: List[Dict]) -> pd.DataFrame:
        """–ü–æ–∫–ª–∞—É–∑–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è"""
        
    def run_and_aggregate_from_json(self, json_data: List[Dict]) -> pd.DataFrame:
        """–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø–æ –æ—Ç–∑—ã–≤–∞–º"""
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
1. **–†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –∫–ª–∞—É–∑—ã**: –¢–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞ ‚Üí —Å–ø–∏—Å–æ–∫ –∫–ª–∞—É–∑
2. **TF-IDF –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ö–ª–∞—É–∑–∞ ‚Üí —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
3. **XLM-RoBERTa –∞–Ω–∞–ª–∏–∑**: –ö–ª–∞—É–∑–∞ + –ø—Ä–æ–¥—É–∫—Ç ‚Üí —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
4. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**: –ö–ª–∞—É–∑—ã ‚Üí –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –æ—Ç–∑—ã–≤—É

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
```python
# –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
input_data = [
    {"id": 1, "text": "–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –æ—Ç–ª–∏—á–Ω–∞—è, –Ω–æ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–º–æ–∑–∏—Ç"}
]

# –ü–æ–∫–ª–∞—É–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
clauses_df = pipeline.run_from_json(input_data)
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# clause_id | clause_text | pred_tfidf | pred_xlmr
# 0 | "–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –æ—Ç–ª–∏—á–Ω–∞—è" | ["–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞"] | {"–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞": "–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ"}
# 1 | "–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–æ—Ä–º–æ–∑–∏—Ç" | ["–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"] | {"–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ": "–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ"}

# –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
final_df = pipeline.run_and_aggregate_from_json(input_data)
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# review_id | pred_agg | pred_tfidf_agg
# 1 | {"–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞": "–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ", "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ": "–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ"} | ["–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞", "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"]
```

## üìä –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–û–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã**: 85%
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –æ—Ç–∑—ã–≤–∞**: ~200 –º—Å
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: ~300 –æ—Ç–∑—ã–≤–æ–≤/–º–∏–Ω—É—Ç—É
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**: ~4 GB (—Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏)

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ –∑–∞–¥–∞—á–∞–º

#### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (TF-IDF)
- **–¢–æ—á–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: 84%
- **–ü–æ–ª–Ω–æ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: 86%
- **F1-Score (macro)**: 0.85
- **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤**: 1.8

#### –ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (XLM-RoBERTa)
- **–¢–æ—á–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**: 86%
- **F1-Score –ø–æ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**: 0.87
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π**: 89%

#### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
- **–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç + —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: 82%
- **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏**: 0.78
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –æ—Ç–∑—ã–≤–∞**: 91%

### Confusion Matrix (—Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
```
                Predicted
Actual      Pos   Neu   Neg
Positive    3168   412   260   (82.5% recall)
Neutral     298  7167   679   (88.0% recall)  
Negative    374   893 14809   (92.1% recall)

Precision:  83.1% 86.3% 87.4%
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
scripts/models/
‚îú‚îÄ‚îÄ TF-IDF.ipynb                # –û–±—É—á–µ–Ω–∏–µ TF-IDF –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ xlm_roBERTa.ipynb           # –û–±—É—á–µ–Ω–∏–µ XLM-RoBERTa –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ inference_pipeline.py       # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ inference_tfidf.py          # TF-IDF –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
‚îú‚îÄ‚îÄ inference_xlmr.py           # XLM-RoBERTa –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
‚îî‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

backend/app/ml/
‚îú‚îÄ‚îÄ pipeline.py                 # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ tfidf_model.py             # TF-IDF –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ xlmr_model.py              # XLM-RoBERTa –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ xlmr_postprocess.py        # –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ utils.py                   # –£—Ç–∏–ª–∏—Ç—ã (—Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è)

models/
‚îú‚îÄ‚îÄ tfidf_lr/
‚îÇ   ‚îî‚îÄ‚îÄ model.pkl              # –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è TF-IDF –º–æ–¥–µ–ª—å
‚îî‚îÄ‚îÄ xlmr/
    ‚îú‚îÄ‚îÄ config.json            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è XLM-RoBERTa
    ‚îú‚îÄ‚îÄ pytorch_model.bin      # –í–µ—Å–∞ –º–æ–¥–µ–ª–∏
    ‚îú‚îÄ‚îÄ tokenizer.json         # –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä
    ‚îî‚îÄ‚îÄ labels.json            # –ú–∞–ø–ø–∏–Ω–≥ –º–µ—Ç–æ–∫
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```txt
# –û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
torch>=2.0.0
transformers>=4.30.0
scikit-learn>=1.3.0
pandas>=2.0.0
numpy>=1.24.0

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
nltk>=3.8
pymorphy3>=2.0.0
regex>=2023.6.3

# –£—Ç–∏–ª–∏—Ç—ã
joblib>=1.3.0
tqdm>=4.65.0
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **CPU**: 4+ cores (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8+)
- **RAM**: 8+ GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16+ GB)
- **GPU**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—É—Å–∫–æ—Ä—è–µ—Ç XLM-RoBERTa –≤ 3-5 —Ä–∞–∑)
- **–î–∏—Å–∫**: 5+ GB –¥–ª—è –º–æ–¥–µ–ª–µ–π

## üöÄ –ó–∞–ø—É—Å–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
```bash
# TF-IDF –º–æ–¥–µ–ª—å
cd scripts/models/
jupyter notebook TF-IDF.ipynb

# XLM-RoBERTa –º–æ–¥–µ–ª—å  
jupyter notebook xlm_roBERTa.ipynb
```

### –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞
cd scripts/models/
python inference_pipeline.py

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API
cd backend/
python -m uvicorn app.main:app --reload
```

### API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
import requests

# –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–∑—ã–≤–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑
response = requests.post(
    "http://localhost:8000/api/v1/predict/",
    files={"file": open("reviews.json", "rb")}
)

result = response.json()
# {
#   "success": true,
#   "data": [
#     {
#       "id": 1,
#       "predicted_sentiment": "–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ",
#       "predicted_products": ["–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"],
#       "confidence": 0.89
#     }
#   ]
# }
```

## üìà –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
1. **Train/Validation/Test split**: 70/15/15
2. **Stratified sampling**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤
3. **Cross-validation**: 5-fold –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
4. **Temporal validation**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline
baseline_accuracy = 0.72  # –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞
hybrid_accuracy = 0.85    # –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞
improvement = (0.85 - 0.72) / 0.72 * 100  # +18% —É–ª—É—á—à–µ–Ω–∏–µ
```

### –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: 99.2% (–ø—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º random_state)
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–∏**: 94% (–Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ 3 –º–µ—Å—è—Ü–∞)
- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —à—É–º—É**: 91% (–ø—Ä–∏ 5% –∏—Å–∫–∞–∂–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞)

## üîç –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ TF-IDF
1. **–ú–Ω–æ–≥–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å**: "–ö–∞—Ä—Ç–∞" ‚Üí –ì–µ–æ–≥—Ä–∞—Ñ–∏—è vs –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞
2. **–°–ª–µ–Ω–≥ –∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è**: "–ú–æ–±–∏–ª–∫–∞" –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è –∫–∞–∫ "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: "–ü–µ—Ä–µ–≤–æ–¥" ‚Üí –î–µ–Ω–µ–∂–Ω—ã–π vs –Ø–∑—ã–∫–æ–≤–æ–π

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ XLM-RoBERTa
1. **–°–∞—Ä–∫–∞–∑–º**: "–û—Ç–ª–∏—á–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ!" –≤ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
2. **–°–º–µ—à–∞–Ω–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ + –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤ –æ–¥–Ω–æ–π –∫–ª–∞—É–∑–µ
3. **–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã**: "–ë–∞–Ω–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 9 –¥–æ 18" ‚Üí –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∏
```python
# –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
improvements = {
    "–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö": "+2-3% —Ç–æ—á–Ω–æ—Å—Ç–∏",
    "–ê–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π": "+1-2% —Ç–æ—á–Ω–æ—Å—Ç–∏", 
    "–î–æ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö": "+3-5% —Ç–æ—á–Ω–æ—Å—Ç–∏",
    "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤": "+1% —Ç–æ—á–Ω–æ—Å—Ç–∏"
}
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏

### –ë–µ–Ω—á–º–∞—Ä–∫ –º–æ–¥–µ–ª–µ–π
| –ú–æ–¥–µ–ª—å | –¢–æ—á–Ω–æ—Å—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å | –ü–∞–º—è—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|----------|----------|---------|-----------|
| **–ù–∞—à–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** | **85%** | **300 –æ—Ç–∑/–º–∏–Ω** | **4 GB** | **–°—Ä–µ–¥–Ω—è—è** |
| –¢–æ–ª—å–∫–æ BERT | 82% | 150 –æ—Ç–∑/–º–∏–Ω | 6 GB | –í—ã—Å–æ–∫–∞—è |
| –¢–æ–ª—å–∫–æ TF-IDF | 76% | 1000 –æ—Ç–∑/–º–∏–Ω | 1 GB | –ù–∏–∑–∫–∞—è |
| –ü—Ä–∞–≤–∏–ª–∞ + —Å–ª–æ–≤–∞—Ä–∏ | 68% | 2000 –æ—Ç–∑/–º–∏–Ω | 0.5 GB | –ù–∏–∑–∫–∞—è |
| GPT-4 API | 91% | 50 –æ—Ç–∑/–º–∏–Ω | - | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è |

### ROI –∞–Ω–∞–ª–∏–∑
- **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**: 95% (vs —Ä—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏**: $0.001 –∑–∞ –æ—Ç–∑—ã–≤ (vs $0.50 —Ä—É—á–Ω–∞—è)
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: 100,000+ –æ—Ç–∑—ã–≤–æ–≤/–¥–µ–Ω—å
- **–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å**: 2-3 –º–µ—Å—è—Ü–∞

```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã

- [03-data-labeling.md](03-data-labeling.md) - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏
- [02-clustering.md](02-clustering.md) - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤  
- [05-backend.md](05-backend.md) - API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π
- [06-frontend.md](06-frontend.md) - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [07-architecture.md](07-architecture.md) - –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–æ–≤ –ì–∞–∑–ø—Ä–æ–º–±–∞–Ω–∫–∞*
